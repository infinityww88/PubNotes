更好的物理模拟

在Unity 2019.3中，PhysX 3.4物理库升级到了PhysX 4.1。虽然4.1库能胜任大部分游戏中的物理模拟，但要制作非游戏的应用、建立逼真模型仍旧力不从心。像人偶、机器人手臂这类包含多个从动关节的系统要建立模型非常困难，关节不仅会看起来奇怪，要模拟真实设备更是不可能，为工业设计建立模型、原型也就无从谈起了。

造成模拟缺陷的原因之一是刚体间的关节组件。这些关节为了提升游戏性能而放弃了动作精度，使得动作不会那么逼真。

## 使用特殊关节制作动作

在部分应用中，刚体的运动会受到相关部件的限制，类似于一个人偶骨架、多关节机器人手臂、以及随铰链运动的门。这些效果在过去已经由FixedJoint（固定关节）和ConfigurableJoint（可配置关节）实现。

每个关节会被分解成几个简单的约束，比如限制运动体移动距离的线性约束、限制运动体运动方向的角度约束。将约束距离分离开来，就能放置运动体重叠到其它部分上。所有约束会组合起来，传入一个迭代解算器，合成一组推动力，应用到相连的对象上，使运动能在可能的情况下满足约束。

## 旧式关节的问题

首先就是多个对抗因素可让解算器出现合并问题：迭代计数、相连运动体的相对质量，并且解算器无法解算过于复杂的约束组。这时，解算器会采用部分运算方案，不会完全遵守某些约束。

第二个问题是推动力的大小根据关节差值确定——差值是指在给定时间内关节运动对约束的偏差。这种错误补偿方法会造成一定的反弹效果，就好像运动体是由弹簧连接的，在多关节连接时效果尤甚。

## Unity连接关节：动作模拟更逼真

针对以上运动问题，Unity 入了连接关节的概念：在一组逻辑树组成的运动体中，用父子对象关系来表达受两个关节限制的动作。运动体之间一定有一个根运动体，且无法建立循环。连接关节通过Unity的Transform层级来表达。

现在，用户可以轻松建立类似通用机器人UR3e的模型，精确地模拟出机器人在现实世界中的运动，藉此可视化特定的动作组、测试新的代码，甚至能在虚拟环境中验证新的机器设计。

连接关节可为机器人专家和其它工业开发者带来两种优势：模拟的运动与现实设备更加相近，开发时间较旧版“刚体+关节”的模式更短。

连接关节的一个主要应用领域是机器人。机器人手臂一般都有六个甚至更多关节成排连接，单个关节上的小错误可能会在最终效应器上被放大；错误的运动会影响整个运动链，造成动作失真，效应部分偏离目标位置。

在机器人开发中，电脑模拟可模拟许多开发情景、测试机器单位，在测试完成后成果便能直接大规模运用，省去了在机器人上运行测试的事件，加快开发流程。有了本次的ArticulationBody组件，以及PhysX的改进，我们希望Unity可协助机器人领域的电脑模拟。

父子运动体中的六自由度根据关节类型而确定。目前，我们支持：

- 固定关节：不带任何自由度，用于固定运动体到其它对象上
- 平移关节：带有一种自由度，即在父对象特定轴上的线性平移
- 旋转关节：带有一种自由度，即在特定轴上的旋转移动
- 球形关节：带有最多三种自由度，只能做相对固定的运动，不能线性平移

为了进一步增加关节的逼真性，我们依据Featherstone算法制作了新的解算器。该技术根据限定的坐标——即每个运动体相对父对象的坐标与自由度相关——来计算力作用于关节、连接部位和运动体的效果。此前，我们在普通用例中会采集尽可能多的坐标，牺牲了精确度来提高性能。

## 前向动态模拟和连接关节

在限定坐标时，前向动态模拟和连接关节可以满足机器人手臂模拟中对精确度的要求。外加上PhysX 4.1带来的其它改善，如TGS解算器，Unity首次成为了机器人手臂模拟的可靠平台。不过，使用迭代式解算器建立机器人模型需要精确的调整和路径，完全模拟机器人的真实运动仍有偏差。

我们使用前向动态算法来模拟连接关节在限定坐标空间中的运动。算法能根据关节自由度的增加线性地扩大运算规模，与传统受约束数量影响的迭代式解算器相比，速度更快、结果更精准。

Unity中的新物理组件：ArticulationBody

为了更好地支持Unity新的连接关节，我们添加了一个全新的组件：ArticulationBody。组件与普通物理组件类似，更像是Rigidbody（刚体）和ConfigurableJoint（可配置关节）的组合。在连接关节中，除根对象以外的所有运动体都有一个与父对象相连的关节，不能作为独立的组件使用。

运动体的形状和刚体一样使用碰撞体组件描述。

在创建完成后，运动体不能经由Transform（变换）组件移动，因为其受限定空间坐标的约束。而根运动体可使用ArticulationBody.TeleportRoot函数移动，也是唯一一个例外。ArticulationBody并不会对Transform组件的改动作出反应。

因此，连接关节有几种特殊的互动方式。第一种，每个运动体都能受力和转矩的影响；第二种，关节在每个自由度上可受特定方向、角度的线性驱动力影响；最后，运动体在限定空间中的姿态是可以改变的。

## 连接关节与固定、可配置关节比较

连接关节一个特别的优势是模拟质量并不直接受运动体质量比的影响。刚体和固定关节在模拟时，如果相连运动体的质量比超过了10：1，模拟就开始变得不真实。而在下方的例子中，红色圆球的质量为黑色圆球的1000倍，但使用固定关节连接的运动体空间网格模拟起来依旧精确。